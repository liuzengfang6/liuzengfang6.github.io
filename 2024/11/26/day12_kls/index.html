<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>day12_kls | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="课程内容shell脚本参数处理getoptsshell脚本模板必须有的脚本描述 脚本使用方法 参数处理 依赖检查 日志 模板可能需要的东西:配置文件处理 调试模式 代理相关分类按协议: http,https,socks 按功能： 正向代理，反向代理 按匿名性： 透明代理，匿名代理，高匿名代理 代理模式系统代理，规则代理 实例&amp;&amp;作业docker-tool自动安装docker，添加代">
<meta property="og:type" content="article">
<meta property="og:title" content="day12_kls">
<meta property="og:url" content="http://example.com/2024/11/26/day12_kls/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="课程内容shell脚本参数处理getoptsshell脚本模板必须有的脚本描述 脚本使用方法 参数处理 依赖检查 日志 模板可能需要的东西:配置文件处理 调试模式 代理相关分类按协议: http,https,socks 按功能： 正向代理，反向代理 按匿名性： 透明代理，匿名代理，高匿名代理 代理模式系统代理，规则代理 实例&amp;&amp;作业docker-tool自动安装docker，添加代">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/assets/image_1732610680509_0.png">
<meta property="og:image" content="http://example.com/assets/image_1732610743279_0.png">
<meta property="og:image" content="http://example.com/assets/image_1732611808092_0.png">
<meta property="article:published_time" content="2024-11-26T05:14:59.000Z">
<meta property="article:modified_time" content="2024-11-27T00:47:00.000Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="kls">
<meta property="article:tag" content="shell">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/assets/image_1732610680509_0.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-day12_kls" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/11/26/day12_kls/" class="article-date">
  <time class="dt-published" datetime="2024-11-26T05:14:59.000Z" itemprop="datePublished">2024-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      day12_kls
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2><span id="课程内容">课程内容</span></h2><h3><span id="shell脚本参数处理getopts">shell脚本参数处理getopts</span></h3><h3><span id="shell脚本模板">shell脚本模板</span></h3><h4><span id="必须有的">必须有的</span></h4><p>脚本描述</p>
<p>脚本使用方法</p>
<p>参数处理</p>
<p>依赖检查</p>
<p>日志</p>
<h4><span id="模板可能需要的东西">模板可能需要的东西:</span></h4><p>配置文件处理</p>
<p>调试模式</p>
<h3><span id="代理相关">代理相关</span></h3><h4><span id="分类">分类</span></h4><p>按协议:</p>
<p>http,https,socks</p>
<p>按功能：</p>
<p>正向代理，反向代理</p>
<p>按匿名性：</p>
<p>透明代理，匿名代理，高匿名代理</p>
<h4><span id="代理模式">代理模式</span></h4><p>系统代理，规则代理</p>
<h2><span id="实例ampamp作业">实例&amp;&amp;作业</span></h2><h3><span id="docker-tool">docker-tool</span></h3><p>自动安装docker，添加代理，镜像等</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">discription:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      a docker tool, intall script, config proxy, mirror</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">author: lzf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">feature:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      1. docker and docker-compose auto install(support centos,ubuntu,debian,kali)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      2. proxy registry-mirrors insecure-registries auto config, via jq</span></span><br><span class="line">help()&#123;</span><br><span class="line">    echo &quot;$0 install/i | proxy/p url | mirror/m url | mirror-addtrust/mt url | add-trust/at url | rm-stoped/rs | compose&quot;</span><br><span class="line">    echo -e &quot;\t install \t\t install docker&quot;</span><br><span class="line">    echo -e &quot;\t proxy url \t\t add proxy&quot;</span><br><span class="line">    echo -e &quot;\t mirror url \t\t add registry-mirrors&quot;</span><br><span class="line">    echo -e &quot;\t add-trust url \t\t add insecure-registries&quot;</span><br><span class="line">    echo -e &quot;\t mirror-addtrust url \t\t add registry-mirrors and insecure-registries&quot;</span><br><span class="line">    echo -e &quot;\t compose \t\t install docker-compose&quot;</span><br><span class="line">    exit 0</span><br><span class="line">&#125;</span><br><span class="line">init()&#123;</span><br><span class="line">    source /etc/os-release</span><br><span class="line">    if command -v jq &gt;/dev/null 2&gt;&amp;1 ;then</span><br><span class="line">        jq_exist=1</span><br><span class="line">    fi</span><br><span class="line">    case $ID in</span><br><span class="line">        centos | ubuntu | debian | kali)</span><br><span class="line">            ;;</span><br><span class="line">        arch)</span><br><span class="line">            echo &quot;正在编写代码，暂不支持$ID&quot;</span><br><span class="line">            #exit 1</span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            echo &quot;Error: $ID is not supported.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">    esac</span><br><span class="line">    # 整个配置文件</span><br><span class="line">    CONFIG_PATH=.docker_tools.conf</span><br><span class="line">    if [ -f $CONFIG_PATH ]; then</span><br><span class="line">        source $CONFIG_PATH</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测依赖软件包</span></span><br><span class="line">check_depen()&#123;</span><br><span class="line">    local depen=(&quot;jq&quot;)</span><br><span class="line">    for c in $&#123;depen[@]&#125;; do</span><br><span class="line">        has_cmd $c || &#123;</span><br><span class="line">            echo &quot;Error: $c is not installed.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        &#125;</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line">has_cmd () &#123;</span><br><span class="line">    command -v $1 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line">install()&#123;</span><br><span class="line">    case $ID in</span><br><span class="line">        ubuntu | debian | kali)</span><br><span class="line">            # 添加公钥</span><br><span class="line">            install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">            curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line">            chmod a+r /etc/apt/keyrings/docker.gpg</span><br><span class="line">            # 参加仓库</span><br><span class="line">            if &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; = &#x27;kali-rolling&#x27; ; then</span><br><span class="line">                echo \</span><br><span class="line">                  &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \</span><br><span class="line">                  buster stable&quot; | \</span><br><span class="line">                  tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">            else</span><br><span class="line">                echo \</span><br><span class="line">                  &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \</span><br><span class="line">                  &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \</span><br><span class="line">                  tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">            fi</span><br><span class="line">            # 安装</span><br><span class="line">            apt-get update</span><br><span class="line">            apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line">            ;;</span><br><span class="line">        centos)</span><br><span class="line">            yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">            yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">            # 这里我们换成清华的源</span><br><span class="line">            sed -i &#x27;s+https://download.docker.com+https://mirrors.tuna.tsinghua.edu.cn/docker-ce+&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">            yum makecache</span><br><span class="line">            yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line">            ;;</span><br><span class="line">        arch)</span><br><span class="line">            # pacman -S docker</span><br><span class="line">            ;;</span><br><span class="line">    esac</span><br><span class="line">&#125;</span><br><span class="line">install_docker_compose()&#123;</span><br><span class="line">    curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line">    chmod +x /usr/local/bin/docker-compose</span><br><span class="line">&#125;</span><br><span class="line">docker_config_init()&#123;</span><br><span class="line">    config_file=&quot;/etc/docker/daemon.json&quot;</span><br><span class="line">    #config_file=&quot;./daemon.json&quot;</span><br><span class="line">    [ -f &quot;$config_file&quot; ] || echo &quot;&#123;&#125;&quot; &gt; &quot;$config_file&quot;</span><br><span class="line">&#125;</span><br><span class="line">modify_config()&#123;</span><br><span class="line">    jq &quot;$1&quot; &quot;$config_file&quot; &gt; &quot;$config_file.tmp&quot; &amp;&amp; mv &quot;$config_file.tmp&quot; &quot;$config_file&quot;</span><br><span class="line">&#125;</span><br><span class="line">proxy()&#123;</span><br><span class="line">    modify_config &quot;.proxies.\&quot;http-proxy\&quot; = \&quot;$1\&quot;&quot; \</span><br><span class="line">        &amp;&amp; echo &quot;http代理配置成功:$1&quot; \</span><br><span class="line">        || echo &quot;ttp代理配置失败&quot;</span><br><span class="line">    modify_config &quot;.proxies.\&quot;https-proxy\&quot; = \&quot;$1\&quot;&quot; \</span><br><span class="line">        &amp;&amp; echo &quot;https代理配置成功:$1&quot; \</span><br><span class="line">        || echo &quot;https代理配置失败&quot;</span><br><span class="line">    # todo 校验</span><br><span class="line">    restart_docker</span><br><span class="line">&#125;</span><br><span class="line">mirror()&#123;</span><br><span class="line">    modify_config  &quot;.[\&quot;registry-mirrors\&quot;] |= if index(\&quot;$1\&quot;) == null then . + [\&quot;$1\&quot;] else . end&quot; \</span><br><span class="line">        &amp;&amp; echo &quot;mirror配置成功:$1&quot; \</span><br><span class="line">        || echo &quot;mirror配置失败&quot;</span><br><span class="line">    # todo 校验</span><br><span class="line">    restart_docker</span><br><span class="line">&#125;</span><br><span class="line">mirror_trust()&#123;</span><br><span class="line">    if [[ $1 =~ http://* ]]; then</span><br><span class="line">        trust=$&#123;1:7:$&#123;#1&#125;&#125;</span><br><span class="line">        echo $trust</span><br><span class="line">        modify_config &quot;if .\&quot;insecure-registries\&quot; | index(\&quot;$trust\&quot;) | not then .\&quot;insecure-registries\&quot; += [\&quot;$trust\&quot;] else . end&quot; \</span><br><span class="line">            &amp;&amp; echo &quot;mirror_trust配置成功:$trust&quot; \</span><br><span class="line">            || echo &quot;mirror_trust配置失败&quot;</span><br><span class="line">        # todo 校验</span><br><span class="line">        restart_docker</span><br><span class="line">    else</span><br><span class="line">        echo &quot;mirror is not http, not change mirror_trust&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line">enable_doceker()&#123;</span><br><span class="line">    systemctl enable --now docker</span><br><span class="line">&#125;</span><br><span class="line">restart_docker()&#123;</span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl restart docker</span><br><span class="line">&#125;</span><br><span class="line">rm_stoped()&#123;</span><br><span class="line">    docker ps -a -f &quot;status=exited&quot; -q | xargs docker rm</span><br><span class="line">&#125;</span><br><span class="line">main()&#123;</span><br><span class="line">    init</span><br><span class="line">    docker_config_init</span><br><span class="line">    if [ $# -eq 0 ]; then</span><br><span class="line">        install</span><br><span class="line">        install_docker_compose</span><br><span class="line">        enable_doceker</span><br><span class="line">    else</span><br><span class="line">        case $1 in</span><br><span class="line">            install | i)</span><br><span class="line">                install</span><br><span class="line">                ;;</span><br><span class="line">            proxy | p)</span><br><span class="line">                # todo 校验输入的参数</span><br><span class="line">                [ -z &quot;$2&quot; ] &amp;&amp; [ -z &quot;$config_proxy&quot; ] &amp;&amp; exit 1</span><br><span class="line">                proxy $&#123;2:-$config_proxy&#125;</span><br><span class="line">                ;;</span><br><span class="line">            mirror | m)</span><br><span class="line">                [ -z &quot;$2&quot; ] &amp;&amp; [ -z &quot;$config_mirror&quot; ] &amp;&amp; exit 1</span><br><span class="line">                mirror $&#123;2:-$config_mirror&#125;</span><br><span class="line">                ;;</span><br><span class="line">            mirror-addtrust | mt)</span><br><span class="line">                [ -z &quot;$2&quot; ] &amp;&amp; [ -z &quot;$config_mirror_trust&quot; ] &amp;&amp; exit 1</span><br><span class="line">                mirror_trust $&#123;2:-$config_mirror_trust&#125;</span><br><span class="line">                [ -z &quot;$2&quot; ] &amp;&amp; [ -z &quot;$config_mirror&quot; ] &amp;&amp; exit 1</span><br><span class="line">                mirror $&#123;2:-$config_mirror&#125;</span><br><span class="line">                ;;</span><br><span class="line">            add-trust | at)</span><br><span class="line">                [ -z &quot;$2&quot; ] &amp;&amp; [ -z &quot;$config_mirror_trust&quot; ] &amp;&amp; exit 1</span><br><span class="line">                 mirror_trust $&#123;2:-$config_mirror_trust&#125;</span><br><span class="line">                ;;</span><br><span class="line">            rm-stoped | rs)</span><br><span class="line">                rm_stoped</span><br><span class="line">                ;;</span><br><span class="line">            compose)</span><br><span class="line">                install_docker_compose</span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                help</span><br><span class="line">                ;;</span><br><span class="line">        esac</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line">main $@</span><br></pre></td></tr></table></figure>

<h3><span id="archjava">archjava</span></h3><p>archlinux官方提供的切换脚本，我们对其稍作修改，让其支持ubuntu，并附带了install功能</p>
<h4><span id="使用">使用</span></h4><p>安装</p>
<p><img src="/../assets/image_1732610680509_0.png" alt="image.png"></p>
<p>查看当前安装了那些</p>
<p><img src="/../assets/image_1732610743279_0.png" alt="image.png"></p>
<p>使用指定版本</p>
<p><img src="/../assets/image_1732611808092_0.png" alt="image.png"></p>
<h4><span id="代码">代码</span></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Arch Linux helper script to <span class="built_in">set</span>/unset/check/fix the enabled Java environment</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This program may be freely redistributed under the terms of the GNU General Public License</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Author: Guillaume ALAUX &lt;guillaume@archlinux.org&gt;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Modify: by lzf, 2024-11-26</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">feature:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      1. add jdk download</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      2. support other linux</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">warning: this script will change /bin/java <span class="built_in">link</span></span></span><br><span class="line">JVM_DIR=/usr/lib/jvm</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">JVM_DIR=./jvm</span></span><br><span class="line">DEFAULT_NAME=default</span><br><span class="line">DEFAULT_PATH=$&#123;JVM_DIR&#125;/$&#123;DEFAULT_NAME&#125;</span><br><span class="line">DEFAULT_NAME_JRE=default-runtime</span><br><span class="line">DEFAULT_PATH_JRE=$&#123;JVM_DIR&#125;/$&#123;DEFAULT_NAME_JRE&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ORIGIN_JAVA_LN=<span class="variable">$PWD</span>/bin/java</span></span><br><span class="line">ORIGIN_JAVA_LN=/bin/java</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Utility <span class="built_in">functions</span></span></span><br><span class="line">check_root() &#123;</span><br><span class="line">  return</span><br><span class="line">  if [ $(id -u) -ne 0 ]; then</span><br><span class="line">    echo &#x27;This script must be run as root&#x27;</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$1</span>: parameter count given to this script <span class="keyword">for</span> this option</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$2</span>: expected parameter count <span class="keyword">for</span> this option</span></span><br><span class="line">check_param_count() &#123;</span><br><span class="line">  if [ $1 -ne $2 ]; then</span><br><span class="line">    echo &#x27;Wrong parameter count&#x27;</span><br><span class="line">    exit 2</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Second level <span class="built_in">functions</span></span></span><br><span class="line">get_default_java() &#123;</span><br><span class="line">  path=$(readlink -e $&#123;DEFAULT_PATH&#125;)</span><br><span class="line">  if [ &quot;x$&#123;path&#125;&quot; != &quot;x/dev/null&quot; ]; then</span><br><span class="line">    echo $&#123;path/$&#123;JVM_DIR&#125;\/&#125;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line">get_installed_javas() &#123;</span><br><span class="line">  if [ -d $&#123;JVM_DIR&#125; ]; then</span><br><span class="line">    for dir in $(find $&#123;JVM_DIR&#125; -mindepth 1 -maxdepth 1 -type d | sort); do</span><br><span class="line">      if [ -x $&#123;dir&#125;/bin/java ]; then</span><br><span class="line">        javas+=($&#123;dir/$&#123;JVM_DIR&#125;\/&#125;)</span><br><span class="line">      else</span><br><span class="line">        if [ -x $&#123;dir&#125;/jre/bin/java ]; then</span><br><span class="line">        javas+=($&#123;dir/$&#123;JVM_DIR&#125;\/&#125;/jre)</span><br><span class="line">        fi</span><br><span class="line">      fi</span><br><span class="line">    done</span><br><span class="line">  fi</span><br><span class="line">  echo $&#123;javas[@]&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$1</span>: Java environment name to <span class="built_in">test</span></span></span><br><span class="line">is_java_valid() &#123;</span><br><span class="line">  test &quot;x$1&quot; != &quot;x$&#123;DEFAULT_NAME&#125;&quot; &amp;&amp; test -x $&#123;JVM_DIR&#125;/$1/bin/java</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$1</span>: Java environment name to <span class="built_in">set</span> as default</span></span><br><span class="line">set_default_link_to() &#123;</span><br><span class="line">  new_default=$1</span><br><span class="line">  unlink $&#123;DEFAULT_PATH&#125; 2&gt;/dev/null</span><br><span class="line">  ln -sf $&#123;new_default&#125; $&#123;DEFAULT_PATH&#125;</span><br><span class="line">  unlink $&#123;DEFAULT_PATH_JRE&#125; 2&gt;/dev/null</span><br><span class="line">  if [[ -d $&#123;new_default&#125;/jre ]]; then</span><br><span class="line">    ln -sf $&#123;new_default&#125;/jre $&#123;DEFAULT_PATH_JRE&#125;</span><br><span class="line">  else</span><br><span class="line">    ln -sf $&#123;new_default&#125; $&#123;DEFAULT_PATH_JRE&#125;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line">unset_default_link() &#123;</span><br><span class="line">  unlink $&#123;DEFAULT_PATH&#125; 2&gt;/dev/null</span><br><span class="line">  unlink $&#123;DEFAULT_PATH_JRE&#125; 2&gt;/dev/null</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">First level <span class="built_in">functions</span></span></span><br><span class="line">do_status() &#123;</span><br><span class="line">  installed_java=($(get_installed_javas))</span><br><span class="line">  if [ $&#123;#installed_java[@]&#125; -eq 0 ]; then</span><br><span class="line">    echo &#x27;No compatible Java environment installed&#x27;</span><br><span class="line">  else</span><br><span class="line">    default_java=$(get_default_java)</span><br><span class="line">    echo &#x27;Available Java environments:&#x27;</span><br><span class="line">    for java in $&#123;installed_java[@]&#125;; do</span><br><span class="line">      # We discoverd this Java env but its JRE is actually set as default</span><br><span class="line">      if [ &quot;$&#123;java&#125;/jre&quot; = &quot;$&#123;default_java&#125;&quot; ]; then</span><br><span class="line">        echo -e &quot;  $&#123;java&#125; ($&#123;java&#125;/jre default)&quot;</span><br><span class="line">      elif [ $&#123;java&#125; = &quot;$&#123;default_java&#125;&quot; ]; then</span><br><span class="line">        echo -e &quot;  $&#123;java&#125; (default)&quot;</span><br><span class="line">      else</span><br><span class="line">        echo &quot;  $&#123;java&#125;&quot;</span><br><span class="line">      fi</span><br><span class="line">    done</span><br><span class="line">    if [ -z $&#123;default_java&#125; ]; then</span><br><span class="line">      echo &quot;No Java environment set as default&quot;</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line">do_get() &#123;</span><br><span class="line">  get_default_java</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$1</span>: Java environment name to <span class="built_in">set</span> as default</span></span><br><span class="line">do_set() &#123;</span><br><span class="line">  if ! is_java_valid $1; then</span><br><span class="line">    echo &quot;&#x27;$&#123;JVM_DIR&#125;/$1&#x27; is not a valid Java environment path&quot;</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line">  default=$(get_default_java)</span><br><span class="line">  if [ &quot;x$1&quot; != &quot;x$&#123;default&#125;&quot; ] || ! is_java_valid $&#123;default&#125;; then</span><br><span class="line">    unset_default_link</span><br><span class="line">    set_default_link_to $1</span><br><span class="line">  fi</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">parent_dir=$(<span class="built_in">dirname</span> <span class="variable">$1</span>)</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="keyword">if</span> is_java_valid <span class="variable">$&#123;parent_dir&#125;</span>; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Warning: &#x27;<span class="variable">$&#123;parent_dir&#125;</span>&#x27; looks like a valid JDK whereas &#x27;<span class="variable">$1</span>&#x27; is set as default&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Fix this with &#x27;archlinux-java set <span class="variable">$&#123;parent_dir&#125;</span>&#x27;&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="keyword">fi</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$1</span>: Java environment name to <span class="built_in">unset</span></span></span><br><span class="line">do_unset() &#123;</span><br><span class="line">  unset_default_link</span><br><span class="line">&#125;</span><br><span class="line">do_fix() &#123;</span><br><span class="line">  default=$(get_default_java)</span><br><span class="line">  if is_java_valid $&#123;default&#125;; then</span><br><span class="line">    # If its parent is also a valid Java environment</span><br><span class="line">    if is_java_valid $(dirname $&#123;default&#125;); then</span><br><span class="line">      unset_default_link</span><br><span class="line">      set_default_link_to $(dirname $&#123;default&#125;)</span><br><span class="line">    fi</span><br><span class="line">  else</span><br><span class="line">    prev=$(readlink $&#123;DEFAULT_PATH&#125;)</span><br><span class="line">    unset_default_link</span><br><span class="line">    potential_fixes=(&quot;$&#123;prev/\/jre&#125;&quot; &quot;$&#123;prev&#125;/jre&quot;)</span><br><span class="line">    openjdk8=(&#x27;java-8-openjdk&#x27; &#x27;java-8-openjdk/jre&#x27;)</span><br><span class="line">    # List of environments to check by order of preference:</span><br><span class="line">    # - first potential fixes of user choices,</span><br><span class="line">    # - then OpenJDK8 as it is considered a default in Arch Linux</span><br><span class="line">    # - finally, any installed environment</span><br><span class="line">    to_check=($&#123;potential_fixes[@]&#125; $&#123;openjdk8[@]&#125; $(get_installed_javas))</span><br><span class="line">    for java in $&#123;to_check[@]&#125;; do</span><br><span class="line">      if ! is_java_valid $(get_default_java) &amp;&amp; is_java_valid $&#123;java&#125;; then</span><br><span class="line">        set_default_link_to $&#123;java&#125;</span><br><span class="line">      fi</span><br><span class="line">    done</span><br><span class="line">  fi</span><br><span class="line">  if ! is_java_valid $(get_default_java); then</span><br><span class="line">    echo &#x27;No valid Java environment found&#x27;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载并解压，避免繁琐的操作</span></span><br><span class="line">download_and_untar()&#123;</span><br><span class="line">  file=&quot;$JVM_DIR/$1&quot;</span><br><span class="line">  wget -O &quot;$file&quot; &quot;$2&quot;</span><br><span class="line">  tar -xf &quot;$file&quot; -C &quot;$JVM_DIR&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里写死了</span></span><br><span class="line">install()&#123;</span><br><span class="line">  case $1 in</span><br><span class="line">    8)</span><br><span class="line">      download_and_untar jdk-8u421-linux-x64.tar.gz https://d.injdk.cn/d/download/oraclejdk/8/jdk-8u421-linux-x64.tar.gz</span><br><span class="line">      ;;</span><br><span class="line">    11)</span><br><span class="line">      download_and_untar jdk-11.0.24_linux-x64_bin.tar.gz https://d.injdk.cn/d/download/oraclejdk/11/jdk-11.0.24_linux-x64_bin.tar.gz</span><br><span class="line">      ;;</span><br><span class="line">    17)</span><br><span class="line">      download_and_untar jdk-17_linux-x64_bin.tar.gz https://d.injdk.cn/d/download/oraclejdk/17/jdk-17_linux-x64_bin.tar.gz</span><br><span class="line">      ;;</span><br><span class="line">    21)</span><br><span class="line">      download_and_untar jdk-21_linux-x64_bin.tar.gz https://d.injdk.cn/d/download/oraclejdk/21/jdk-21_linux-x64_bin.tar.gz</span><br><span class="line">      ;;</span><br><span class="line">    23)</span><br><span class="line">      download_and_untar jdk-23_linux-x64_bin.tar.gz https://d.injdk.cn/d/download/oraclejdk/23/jdk-23_linux-x64_bin.tar.gz</span><br><span class="line">      ;;</span><br><span class="line">    *)</span><br><span class="line">      echo &quot;暂不支持$1&quot;</span><br><span class="line">      exit 1</span><br><span class="line">      ;;</span><br><span class="line">  esac</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">为了兼容其他发行版，强制将/bin/java连接到了<span class="variable">$JDK_DIR</span>/default/bin/java</span></span><br><span class="line">change_ln()&#123;</span><br><span class="line">  if [ -f $ORIGIN_JAVA_LN ];then</span><br><span class="line">    if ! [[ $(readlink $ORIGIN_JAVA_LN) == *default* ]]; then</span><br><span class="line">      cp $ORIGIN_JAVA_LN &quot;.$ORIGIN_JAVA_LN.back&quot;</span><br><span class="line">      unlink /bin/java</span><br><span class="line">      ln -s &quot;$JVM_DIR/default/bin/java&quot; $ORIGIN_JAVA_LN</span><br><span class="line">    fi</span><br><span class="line">  else</span><br><span class="line">    ln -s &quot;$JVM_DIR/default/bin/java&quot; $ORIGIN_JAVA_LN</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line">usage() &#123;</span><br><span class="line">  echo &quot;$(basename $0) &lt;COMMAND&gt;&quot;</span><br><span class="line">  echo -e &quot;\nCOMMAND:&quot;</span><br><span class="line">  echo -e &#x27;\tstatus\t\tList installed Java environments and enabled one&#x27;</span><br><span class="line">  echo -e &#x27;\tget\t\tReturn the short name of the Java environment set as default&#x27;</span><br><span class="line">  echo -e &#x27;\tset &lt;JAVA_ENV&gt;\tForce &lt;JAVA_ENV&gt; as default&#x27;</span><br><span class="line">  echo -e &#x27;\tunset\t\tUnset current default Java environment&#x27;</span><br><span class="line">  echo -e &#x27;\tfix\t\tFix an invalid/broken default Java environment configuration&#x27;</span><br><span class="line">  echo -e &#x27;\tinstall 8/11/17/21/23\t\tInstall jdk tar&#x27;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化</span></span><br><span class="line">init()&#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">判断jvm目录是否存在</span></span><br><span class="line">  if [ ! -d &quot;$JVM_DIR&quot; ]; then</span><br><span class="line">    mkdir -p &quot;$JVM_DIR&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Main</span></span></span><br><span class="line">init</span><br><span class="line">case $1 in</span><br><span class="line">  &#x27;status&#x27;) do_status;;</span><br><span class="line">  &#x27;get&#x27;)    do_get;;</span><br><span class="line">  &#x27;set&#x27;)    check_root; check_param_count $# 2; do_set $2; change_ln;;</span><br><span class="line">  &#x27;unset&#x27;)  check_root; do_unset;;</span><br><span class="line">  &#x27;fix&#x27;)    check_root; do_fix;;</span><br><span class="line">  &#x27;install&#x27;) check_root; install $2;;</span><br><span class="line">  &#x27;help&#x27; | &#x27;--help&#x27; | &#x27;-h&#x27; | &#x27;&#x27;) usage;;</span><br><span class="line">  *)           echo &quot;$(basename $0): unknown option &#x27;$@&#x27;&quot;; exit 1;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3><span id="网卡配置">网卡配置</span></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测系统类型</span></span><br><span class="line">function detect_os() &#123;</span><br><span class="line">    if [[ -f /etc/os-release ]]; then</span><br><span class="line">        . /etc/os-release</span><br><span class="line">        echo &quot;$ID&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;无法检测操作系统类型。&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改 IP 地址</span></span><br><span class="line">function set_ip() &#123;</span><br><span class="line">    local iface=&quot;$1&quot;</span><br><span class="line">    local ip=&quot;$2&quot;</span><br><span class="line">    local netmask=&quot;$3&quot;</span><br><span class="line">    sudo ip addr flush dev &quot;$iface&quot;  # 清除现有 IP 地址</span><br><span class="line">    sudo ip addr add &quot;$ip/$netmask&quot; dev &quot;$iface&quot;  # 添加新 IP 地址</span><br><span class="line">    sudo ip link set &quot;$iface&quot; up  # 启动网卡</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改 DNS</span></span><br><span class="line">function set_dns() &#123;</span><br><span class="line">    local dns=&quot;$1&quot;</span><br><span class="line">    local connection_name=&quot;$(nmcli -t -f name con show --active | grep -m 1 &quot;$iface&quot;)&quot;</span><br><span class="line">    if [ -z &quot;$connection_name&quot; ]; then</span><br><span class="line">        echo &quot;未找到活动连接，无法设置 DNS。&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">    nmcli con mod &quot;$connection_name&quot; ipv4.dns &quot;$dns&quot;</span><br><span class="line">    nmcli con up &quot;$connection_name&quot;  # 重新启动连接</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主程序</span></span><br><span class="line">OS_NAME=$(detect_os)</span><br><span class="line">read -p &quot;请输入网卡名称 (例如 ens33): &quot; iface</span><br><span class="line">read -p &quot;请输入新的 IP 地址 (例如 192.168.1.122): &quot; ip</span><br><span class="line">read -p &quot;请输入子网掩码 (例如 24): &quot; netmask</span><br><span class="line">read -p &quot;请输入新的 DNS 地址 (例如 8.8.8.8): &quot; dns</span><br><span class="line">set_ip &quot;$iface&quot; &quot;$ip&quot; &quot;$netmask&quot;</span><br><span class="line">set_dns &quot;$dns&quot;</span><br></pre></td></tr></table></figure>

<h2><span id="思考ampamptodo">思考&amp;&amp;todo</span></h2><h2><span id="参考">参考</span></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/11/26/day12_kls/" data-id="cm3z62vq40004wyiw78wuh4zg" data-title="day12_kls" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kls/" rel="tag">kls</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/" rel="tag">shell</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/11/25/day11_kls/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">day11_kls</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-compose/" rel="tag">docker-compose</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dvwa/" rel="tag">dvwa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exam/" rel="tag">exam</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firewalld/" rel="tag">firewalld</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp/" rel="tag">ftp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kls/" rel="tag">kls</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/" rel="tag">linux常见服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rce/" rel="tag">rce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/review/" rel="tag">review</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selinux/" rel="tag">selinux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/smb/" rel="tag">smb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh-copy-id/" rel="tag">ssh-copy-id</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ufw/" rel="tag">ufw</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virt-manager/" rel="tag">virt-manager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="tag">虚拟化</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/docker/" style="font-size: 13.33px;">docker</a> <a href="/tags/docker-compose/" style="font-size: 13.33px;">docker-compose</a> <a href="/tags/dvwa/" style="font-size: 10px;">dvwa</a> <a href="/tags/exam/" style="font-size: 10px;">exam</a> <a href="/tags/firewalld/" style="font-size: 10px;">firewalld</a> <a href="/tags/ftp/" style="font-size: 10px;">ftp</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/kls/" style="font-size: 20px;">kls</a> <a href="/tags/linux/" style="font-size: 16.67px;">linux</a> <a href="/tags/linux%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/" style="font-size: 10px;">linux常见服务</a> <a href="/tags/rce/" style="font-size: 10px;">rce</a> <a href="/tags/review/" style="font-size: 13.33px;">review</a> <a href="/tags/selinux/" style="font-size: 10px;">selinux</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/smb/" style="font-size: 10px;">smb</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/ssh-copy-id/" style="font-size: 10px;">ssh-copy-id</a> <a href="/tags/ufw/" style="font-size: 10px;">ufw</a> <a href="/tags/virt-manager/" style="font-size: 10px;">virt-manager</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" style="font-size: 10px;">虚拟化</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/11/26/day12_kls/">day12_kls</a>
          </li>
        
          <li>
            <a href="/2024/11/25/day11_kls/">day11_kls</a>
          </li>
        
          <li>
            <a href="/2024/11/23/day10_kls_review/">day10_kls_review</a>
          </li>
        
          <li>
            <a href="/2024/11/22/week2_kls_exam/">week2_kls_exam</a>
          </li>
        
          <li>
            <a href="/2024/11/21/day9_kls/">day9_kls</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>